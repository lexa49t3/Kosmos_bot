<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>üçï –ü–∞–Ω–µ–ª—å –¥–æ—Å—Ç–∞–≤–∫–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        h1 { color: #e53935; text-align: center; margin-bottom: 25px; }
        .card { margin: 18px 0; padding: 18px; border: 1px solid #eee; border-radius: 8px; background: #fff; }
        .queue-item { background-color: #e8f4fc; }
        .btn { background: #e53935; color: white; border: none; padding: 9px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .btn:hover { opacity: 0.9; }
        .btn-success { background: #43a047; }
        table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        th, td { padding: 11px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f5f5f5; font-weight: 600; }
        .empty { color: #757575; font-style: italic; text-align: center; padding: 15px; }
        .footer { text-align: center; margin-top: 30px; color: #9e9e9e; font-size: 13px; }
    </style>
</head>
<body>
<div class="container">
    <h1>üçï –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–æ–π</h1>

    <!-- –û—á–µ—Ä–µ–¥—å -->
    <div class="card">
        <h3>üìã –¢–µ–∫—É—â–∞—è –æ—á–µ—Ä–µ–¥—å</h3>
        {% if queue %}
            <p><strong>–í—Å–µ–≥–æ –∫—É—Ä—å–µ—Ä–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏: {{ queue|length }}</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–ö—É—Ä—å–µ—Ä</th>
                        <th>–°</th>
                        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in queue %}
                    <tr class="queue-item">
                        <td>{{ loop.index }}</td>
                        <td><strong>{{ item.name }}</strong></td>
                        <td>
                            {% if item.join_time %}
                                {{ item.join_time.split('T')[0] }}
                                {{ item.join_time.split('T')[1][:5] }}
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                        <td>
                            <form method="POST" action="/assign" style="display:inline;">
                                <input type="hidden" name="tg_id" value="{{ item.tg_id }}">
                                <button class="btn" type="submit">üì¶ –ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">üì≠ –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</p>
        {% endif %}
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        {% if stats %}
            <table>
                <thead>
                    <tr>
                        <th>–ö—É—Ä—å–µ—Ä</th>
                        <th>–í—Å–µ–≥–æ</th>
                        <th>–°–µ–≥–æ–¥–Ω—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in stats %}
                    <tr>
                        <td><strong>{{ s.name }}</strong></td>
                        <td>{{ s.total or 0 }}</td>
                        <td>{{ s.today or 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
        {% endif %}
    </div>

    <form method="POST" action="/refresh">
        <button class="btn" type="submit">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </form>

    <div class="footer">
        üöÄ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Railway ‚Ä¢ {{ moment().format('DD.MM.YYYY HH:mm') if false else '' }}
    </div>
</div>
</body>
</html>